(function(a){function b(d,c){this.box=a(d);this.config=a.extend({},c||{});this.width=this.config.width||this.box.children().eq(0).width();this.size=this.config.size||this.box.children().length;this.loop=this.config.loop||true;this.auto=this.config.auto||true;this.auto_wait_time=this.config.auto_wait_time||3000;this.scroll_time=300;this.minleft=-this.width*(this.size-1);this.maxleft=0;this.now_left=0;this.point_x=null;this.point_y=null;this.move_left=false;this.index=0;this.busy=false;this.timer;this.init()}a.extend(b.prototype,{init:function(){this.bind_event();this.init_loop();this.auto_scroll()},bind_event:function(){var c=this;c.box.bind("touchstart",function(d){if(d.touches.length==1&&!c.busy){c.point_x=d.touches[0].screenX;c.point_y=d.touches[0].screenY}}).bind("touchmove",function(d){if(d.touches.length==1&&!c.busy){return c.move(d.touches[0].screenX,d.touches[0].screenY)}}).bind("touchend",function(d){!c.busy&&c.move_end()})},init_loop:function(){if(this.box.children().length==this.size&&this.loop){this.now_left=-this.width;this.minleft=-this.width*this.size;this.maxleft=-this.width;this.box.prepend(this.box.children().eq(this.size-1).clone()).append(this.box.children().eq(1).clone()).css(this.get_style(2));this.box.css("width",this.width*(this.size+2))}else{this.loop=false;this.box.css("width",this.width*this.size)}},auto_scroll:function(){var c=this;if(!c.loop||!c.auto){return}clearTimeout(c.timer);c.timer=setTimeout(function(){c.go_index(c.index+1)},c.auto_wait_time)},go_index:function(d){var c=this;if(c.busy){return}clearTimeout(c.timer);c.busy=true;if(c.loop){d=d<0?-1:d;d=d>c.size?c.size:d}else{d=d<0?0:d;d=d>=c.size?(c.size-1):d}if(!c.loop&&(c.now_left==-(c.width*d))){c.complete(d)}else{if(c.loop&&(c.now_left==-c.width*(d+1))){c.complete(d)}else{if(d==-1||d==c.size){c.index=d==-1?(c.size-1):0;c.now_left=d==-1?0:-c.width*(c.size+1)}else{c.index=d;c.now_left=-(c.width*(c.index+(c.loop?1:0)))}c.box.css(this.get_style(1));setTimeout(function(){c.complete(d)},c.scroll_time)}}},complete:function(d){var c=this;c.busy=false;c.config.callback&&c.config.callback(c.index);if(d==-1){c.now_left=c.minleft}else{if(d==c.size){c.now_left=c.maxleft}}c.box.css(this.get_style(2));c.auto_scroll()},next:function(){if(!this.busy){this.go_index(this.index+1)}},prev:function(){if(!this.busy){this.go_index(this.index-1)}},move:function(f,d){var i=f-(this.point_x===null?f:this.point_x),g=d-(this.point_y===null?d:this.point_y),h=this.now_left,c=false,e=g/Math.sqrt(i*i+g*g);this.now_left=h+i;this.move_left=i<0;if(e>Math.sin(Math.PI/3)||e<-Math.sin(Math.PI/3)){c=true}this.point_x=f;this.point_y=d;this.box.css(this.get_style(2));return c},move_end:function(){var d=this.now_left%this.width,c;if(this.now_left<this.minleft){c=this.index+1}else{if(this.now_left>this.maxleft){c=this.index-1}else{if(d!=0){if(this.move_left){c=this.index+1}else{c=this.index-1}}else{c=this.index}}}this.point_x=this.point_y=null;this.go_index(c)},get_style:function(d){var c=this.now_left,e=d==1?this.scroll_time:0;return{"-webkit-transition":"-webkit-transform "+e+"ms","-webkit-transform":"translate3d("+c+"px,0,0)","-webkit-backface-visibility":"hidden","transition":"transform "+e+"ms","transform":"translate3d("+c+"px,0,0)"}}});a.mggScrollImg=function(e,d){var c=new b(e,d);return{next:function(){c.next()},prev:function(){c.prev()},go:function(f){c.go_index(parseInt(f)||0)}}}})(Zepto);